syntax = "proto3";
package gladys.v1;

import "common.proto";
import "types.proto";

// ExecutiveService - the decision-making component.
// Receives events/moments from Orchestrator and processes them.
service ExecutiveService {
    // Process a high-salience event immediately (bypasses moment accumulation)
    rpc ProcessEvent(ProcessEventRequest) returns (ProcessEventResponse);

    // Process an accumulated moment (batch of events on tick)
    rpc ProcessMoment(ProcessMomentRequest) returns (ProcessMomentResponse);

    // Provide feedback on a previous response (for heuristic formation)
    rpc ProvideFeedback(ProvideFeedbackRequest) returns (ProvideFeedbackResponse);

    // Health check
    rpc GetHealth(gladys.types.GetHealthRequest) returns (gladys.types.GetHealthResponse);
    rpc GetHealthDetails(gladys.types.GetHealthDetailsRequest) returns (gladys.types.GetHealthDetailsResponse);
}

// Request to process a single high-salience event
message ProcessEventRequest {
    Event event = 1;
    bool immediate = 2;
    RequestMetadata metadata = 15;
}

message ProcessEventResponse {
    bool accepted = 1;
    string error_message = 2;
    string response_id = 3;
    string response_text = 4;
    float predicted_success = 5;
    float prediction_confidence = 6;
}

// Request to process an accumulated moment
message ProcessMomentRequest {
    Moment moment = 1;
    RequestMetadata metadata = 15;
}

message ProcessMomentResponse {
    bool accepted = 1;
    string error_message = 2;
    int32 events_processed = 3;
}

// Request to provide feedback on a previous LLM response
message ProvideFeedbackRequest {
    string event_id = 1;
    bool positive = 2;
    string response_id = 3;
    RequestMetadata metadata = 15;
}

message ProvideFeedbackResponse {
    bool accepted = 1;
    string error_message = 2;
    string created_heuristic_id = 3;
}
