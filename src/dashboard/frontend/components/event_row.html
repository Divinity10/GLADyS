<!-- Main Row -->
<tr id="event-{{ event.id }}"
    class="cursor-pointer transition-colors border-b border-gray-800 hover:bg-gray-800"
    onclick="var d=document.getElementById('detail-{{ event.id }}'); d.style.display = d.style.display === 'none' ? '' : 'none'; this.classList.toggle('row-expanded')">
    <td class="text-secondary text-[11px] truncate">{{ event.time_relative }} ({{ event.time_absolute }})</td>
    <td class="truncate"><span class="px-1 bg-gray-700 rounded text-[11px]">{{ event.source }}</span></td>
    <td class="truncate max-w-xs" title="{{ event.text }}">{{ event.text }}</td>
    <td>
        <span class="px-1 rounded text-[10px] uppercase font-bold
            {% if event.status == 'responded' %}bg-green-900 text-green-300
            {% elif event.status == 'processing' %}bg-yellow-900 text-yellow-300
            {% elif event.status == 'queued' %}bg-blue-900 text-blue-300
            {% else %}bg-red-900 text-red-300{% endif %}">
            {{ event.status }}
        </span>
    </td>
    <td class="text-[11px] truncate">{{ event.path or 'â€”' }}</td>
    <td class="truncate max-w-md text-secondary" title="{{ event.response_text }}">{{ event.response_text or 'â€”' }}</td>
</tr>

<!-- Detail Row (Hidden by default) -->
<tr id="detail-{{ event.id }}" class="bg-gray-800 border-b border-gray-600" style="display: none;">
    <td colspan="6" class="p-4" onclick="event.stopPropagation()">
        <div class="grid grid-cols-2 gap-8">
            <div>
                <h4 class="text-xs font-bold text-secondary uppercase mb-2">Event Detail</h4>
                <p class="mb-4 text-sm text-white select-text">{{ event.text }}</p>

                <h4 class="text-xs font-bold text-secondary uppercase mb-2">IDs &amp; Routing</h4>
                <div class="grid grid-cols-[auto_1fr] gap-x-4 gap-y-1 text-xs select-text">
                    <span class="text-secondary">Event ID:</span> <span class="font-mono text-[11px]">{{ event.id }}</span>
                    {% if event.response_id %}
                    <span class="text-secondary">Response ID:</span> <span class="font-mono text-[11px]">{{ event.response_id }}</span>
                    {% endif %}
                    <span class="text-secondary">Source:</span> <span>{{ event.source }}</span>
                    <span class="text-secondary">Path:</span> <span>{{ event.path or 'â€”' }}</span>
                    <span class="text-secondary">Salience:</span> <span>{{ event.salience_score }}</span>
                    <span class="text-secondary">Confidence:</span> <span>{{ event.confidence }}</span>
                </div>
            </div>
            <div>
                <h4 class="text-xs font-bold text-secondary uppercase mb-2">Response</h4>
                <p class="mb-4 text-sm text-white select-text">{{ event.response_text or 'No response yet' }}</p>

                {% if event.status == 'responded' %}
                <div class="flex gap-2">
                    <button hx-post="/api/feedback"
                            hx-vals='{"event_id": "{{ event.id }}", "feedback": "good"}'
                            class="btn text-green-400">ğŸ‘ Good</button>
                    <button hx-post="/api/feedback"
                            hx-vals='{"event_id": "{{ event.id }}", "feedback": "bad"}'
                            class="btn text-red-400">ğŸ‘ Bad</button>
                </div>
                {% endif %}
            </div>
        </div>

        {% if event.salience_breakdown %}
        <div class="mt-4 pt-4 border-t border-gray-700">
            <h4 class="text-xs font-bold text-secondary uppercase mb-2">Salience Breakdown</h4>
            <div class="flex flex-wrap gap-4 text-[10px] select-text">
                {% for key, val in event.salience_breakdown.items() %}
                <div class="flex flex-col items-center">
                    <span class="text-secondary">{{ key.replace('_', ' ') }}</span>
                    <span class="font-bold">{{ val }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </td>
</tr>
