{% from 'components/widgets/expandable_row.html' import expandable_row_start, expandable_row_drilldown_start, expandable_row_end, drilldown_loading, checkbox_cell, source_cell, text_cell, decision_path_cell, linked_cell %}

{% for r in responses %}

{{ expandable_row_start(r.event_id, 'grid-cols-[30px_120px_80px_1fr_90px_100px]') }}

    {{ checkbox_cell(r.event_id, 'window.responseSelection') }}

    <!-- Timestamp -->
    <div class="text-gray-400 text-xs" title="{{ r.timestamp }}">
        {{ r.time_relative }}
    </div>

    {{ source_cell(r.source) }}

    {{ text_cell(r.raw_text, '') }}

    {{ decision_path_cell(r.decision_path) }}

    <!-- Heuristic link -->
    {% if r.matched_heuristic_id %}
    {{ linked_cell(
        r.matched_heuristic_condition or r.matched_heuristic_id[:8],
        "$dispatch('switch-tab', { tab: 'heuristics', filter: 'id', value: '" ~ r.matched_heuristic_id ~ "' })"
    ) }}
    {% else %}
    <div class="text-gray-600 text-xs">â€”</div>
    {% endif %}

{{ expandable_row_drilldown_start(r.event_id, '/api/responses/' ~ r.event_id) }}
    {{ drilldown_loading() }}
{{ expandable_row_end() }}

{% endfor %}

{% if not responses %}
<div class="p-8 text-center text-gray-500">
    No responses found matching criteria.
</div>
{% endif %}
