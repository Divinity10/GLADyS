{% from 'components/widgets/expandable_row.html' import expandable_row_start, expandable_row_drilldown_start, expandable_row_end, chevron_cell, condition_cell, outcome_badge_cell, confidence_cell, linked_cell %}

{# Learning Row - Uses expandable_row macros for consistent structure #}

{{ expandable_row_start(f.id, 'grid-cols-[20px_100px_1fr_1fr_80px_80px_80px]') }}

    {{ chevron_cell() }}

    <!-- Time -->
    <div class="text-gray-400 text-[11px]">
        {% if f.fired_at %}{{ f.fired_at[11:19] }}{% else %}—{% endif %}
    </div>

    <!-- Heuristic Name (link to Heuristics tab) -->
    {{ linked_cell(
        f.heuristic_name or f.heuristic_id[:12] or '(unknown)',
        "window.dispatchEvent(new CustomEvent('switch-tab', { detail: { tab: 'heuristics', filter: 'id', value: '" ~ f.heuristic_id ~ "' } }))"
    ) }}

    {{ condition_cell(f.condition_text, 50) }}
    {{ outcome_badge_cell(f.outcome) }}

    <!-- Feedback Source -->
    <div class="text-gray-500 text-xs">{{ f.feedback_source or '—' }}</div>

    {{ confidence_cell(f.confidence) }}

{{ expandable_row_drilldown_start(f.id) }}

    <!-- Drilldown: Two-column layout -->
    <div class="bg-gray-900/50 p-4 text-sm">
        <div class="grid grid-cols-2 gap-6 text-xs">
            <div>
                <h4 class="font-bold text-gray-400 mb-2 uppercase tracking-wider text-[10px]">Heuristic Details</h4>
                <div class="space-y-2 text-gray-500">
                    <div class="flex justify-between border-b border-gray-800 py-1">
                        <span class="font-medium">Fire ID:</span>
                        <span class="font-mono text-gray-400">{{ f.id[:12] }}...</span>
                    </div>
                    <div class="flex justify-between border-b border-gray-800 py-1">
                        <span class="font-medium">Heuristic ID:</span>
                        <span class="font-mono text-gray-400">{{ f.heuristic_id[:12] }}...</span>
                    </div>
                    <div class="flex justify-between border-b border-gray-800 py-1">
                        <span class="font-medium">Event ID:</span>
                        <span class="font-mono text-gray-400">{{ f.event_id[:12] if f.event_id else '—' }}{% if f.event_id and f.event_id|length > 12 %}...{% endif %}</span>
                    </div>
                    <div class="flex justify-between border-b border-gray-800 py-1">
                        <span class="font-medium">Fired At:</span>
                        <span class="text-gray-400">{{ f.fired_at or '—' }}</span>
                    </div>
                </div>
            </div>
            <div>
                <h4 class="font-bold text-gray-400 mb-2 uppercase tracking-wider text-[10px]">Condition Text</h4>
                <div class="bg-gray-900 p-3 rounded border border-gray-700 font-mono text-gray-300 text-[11px] leading-relaxed">
                    {{ f.condition_text or '(empty)' }}
                </div>
            </div>
        </div>
    </div>

{{ expandable_row_end() }}
